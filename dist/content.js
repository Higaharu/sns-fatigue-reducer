(()=>{"use strict";let e=0,t=Date.now(),n={enabled:!0,fatigueThreshold:70,blurIntensity:5,sites:{"twitter.com":!0,"x.com":!0,"facebook.com":!0,"instagram.com":!0}},o=!1,s=null;const a={"twitter.com":{posts:"article",trending:'[data-testid="trend"]',sidebar:'[data-testid="sidebarColumn"]'},"x.com":{posts:"article",trending:'[data-testid="trend"]',sidebar:'[data-testid="sidebarColumn"]'},"facebook.com":{posts:".x1lliihq",trending:".x1jx94hy",sidebar:".x1qjc9v5"},"instagram.com":{posts:"article",feed:"._aak6",explore:"._aagw"}};function i(){const t=document.querySelector(".sns-fatigue-gauge .gauge-fill");if(!t)return;let n="#4caf50";e>=30&&e<70?n="#ff9800":e>=70&&(n="#f44336"),t.style.backgroundColor=n,t.style.width=`${e}%`;const o=document.querySelector(".sns-fatigue-gauge .gauge-text");o&&(o.textContent=`${e}%`)}function c(){s&&(s.style.display="none"),o=!1}function l(){const e=window.location.hostname.replace("www.",""),t=a[e];if(!t)return;let n="";const o=t.posts;o&&document.querySelectorAll(o).forEach((e=>{n+=e.textContent+"\n\n"})),chrome.runtime.sendMessage({type:"CONTENT_DATA",content:n.trim(),url:window.location.href})}!function(){const r=window.location.hostname.replace("www.","");chrome.storage.local.get(["settings","stats"],(o=>{o.settings&&(n=o.settings);const s=(o.stats||{})[r]||{timeSpent:0,fatigueLevel:0};e=s.fatigueLevel,function(){const t=document.createElement("div");t.className="sns-fatigue-gauge",t.innerHTML=`\n    <div class="gauge-fill" style="width: ${e}%"></div>\n    <div class="gauge-text">${e}%</div>\n  `;const n=document.createElement("style");n.textContent="\n  .gauge-text {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    color: black;        /* ← ★ 文字の色！ */\n    font-weight: bold;\n    font-size: 13px;\n    text-align: center;\n    line-height: 20px;\n    z-index: 10000;\n    pointer-events: none;\n  }\n",document.head.appendChild(n),t.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 100px;\n    height: 20px;\n    background: #eee;\n    border-radius: 10px;\n    overflow: hidden;\n    z-index: 9999;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n  ",document.body.appendChild(t),i()}(),setInterval((()=>{if(!n.enabled)return;const o=window.location.hostname.replace("www.","");if(!n.sites[o])return;const s=Math.floor((Date.now()-t)/1e3);e=Math.min(100,Math.floor(s/30)),chrome.storage.local.get(["stats"],(t=>{const n=t.stats||{};n[o]={timeSpent:s,fatigueLevel:e},chrome.storage.local.set({stats:n})})),i(),e>=n.fatigueThreshold&&function(){const t=window.location.hostname.replace("www.",""),o=a[t];if(!o)return;const s=Math.max(1,Math.min(20,n.blurIntensity*(e-n.fatigueThreshold)/(100-n.fatigueThreshold)));Object.values(o).forEach((e=>{document.querySelectorAll(e).forEach((e=>{e.style.filter=`blur(${s}px)`}))}))}()}),1e4)})),chrome.runtime.onMessage.addListener(((e,t,a)=>{switch(e.type){case"OPEN_SIDEPANEL":o=!0,function(){if(s)return void(s.style.display="block");s=document.createElement("div"),s.className="sns-fatigue-sidepanel",s.innerHTML='\n    <div class="panel-content">\n      <div class="panel-header">\n        <h2>読み込み中...</h2>\n        <button class="close-btn">×</button>\n      </div>\n      <div class="panel-body">\n        <div class="loading">コンテンツを取得中...</div>\n      </div>\n    </div>\n  ',s.style.cssText="\n    position: fixed;\n    top: 0;\n    right: 0;\n    width: 350px;\n    height: 100vh;\n    background: white;\n    box-shadow: -2px 0 10px rgba(0,0,0,0.2);\n    z-index: 10000;\n    transition: transform 0.3s ease;\n  ",document.body.appendChild(s);const e=s.querySelector(".close-btn");e&&e.addEventListener("click",(()=>{c()})),l()}();break;case"CLOSE_SIDEPANEL":c();break;case"REQUEST_CONTENT":l();break;case"UPDATE_SETTINGS":n=e.settings}return a({success:!0}),!0}))}()})();